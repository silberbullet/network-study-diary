# 5-2 HTTP

스터디 일자 : 2024.10.06 (일) 20:00

[스터디 끝난 회고](#-스터디-끝난-회고)

## 📚 공부 정리
### 📌 HTTP의 특성

**❗TCP 통신 3단계**

**연결 수립 →  데이터 송수신 → 연결 종료**

- **데이터 송수신** : 재전송을 통한 오류 제어, 흐름 제어, 혼잡 제어 등의 기능을 제공
- **MSS** : TCP로 전송할 수 있는 최대 페이로드 크기 **( TCP 헤더의 크기는 제외 )**

https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F18T43%2FbtrgBmg94PP%2FwXkcVUy9C0bwbXBj5HXLHk%2Fimg.png

- **IP MTU ( P.145 참고 )**
    - IP 패킷을 전송할 때 네트워크 계층에서 처리할 수 있는 가장 큰 데이터 블록

---

**❗TCP 세그먼트 헤더 구조**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f2636925-e81c-435b-900d-85ba6696597a/7f5b90a1-0e3f-46b3-ba72-4cf20de707ff/image.png)

- **송신지(출발지) 포트 , 수신지(목적지) 포트**
    - 송신지 또는 수신지의 애플리케이션을 식별하는 포트 번호

- **순서 번호 (일련번호)**
    - 송수신 되는 세그먼트의 올바른 순서 보장을 위한 세그먼트 첫 바이트에 부여되는 번호

- **확인 응답 번호**
    - 상대 호스트가 보낸 세그먼트에 대한 응답

- **제어 비트(코드 비트)**
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f2636925-e81c-435b-900d-85ba6696597a/065834b0-1749-44c8-a9da-570d9f923c43/image.png)
    
    - 플래그 비트( Flag bits)
    - 세그먼트에 대한 부가 정보 **( 연결의 제어 정보가 기록되어 있음 )**
    - 모든 초기값은 0 이며 활성화시 1로 표기
        - SYN : 연결 요청
        - ACK : 확인 응답
        - FIN : 연결 종료

- **윈도우**
    - 수신 윈도우 크기
    - 한번에 수신하고자 하는 데이터의 양

---

**❗제어 비트**

**제어 비트는 기본적으로 8비트 이지만 경우에 따라서, 6비트 혹은 9비트로 쓰임**

- **URG** (Urgent) - 긴급 포인터가 유효함을 나타냄
- **ACK** (Acknowledgment) - 응답 번호가 유효함을 나타냄
- **PSH** (Push) - 수신자가 데이터를 즉시 상위 계층으로 전달하도록 요청
- **RST** (Reset) - 연결을 강제로 초기화하거나 종료할 때 사용
- **SYN** (Synchronize) - 연결 설정을 요청할 때 사용.
- **FIN** (Finish) - 연결을 종료할 때 사용
- **ECE** (Explicit Congestion Notification Echo) - ECN(Explicit Congestion Notification) 기능을 사용 중이며, 혼잡 상태를 나타냄.
- **CWR** (Congestion Window Reduced) - 송신 측에서 혼잡 상태에 반응하여 혼잡 창을 줄였음을 알림
- **NS** (Nonce Sum) - ECN nonce sum으로 사용되며, ECN의 신뢰성을 보장

---

**❗순서 번호와 확인 응답 번호**

- **순서번호 채번 과정**
    - 순서번호는 MSS 단위로 전송이 가능
    - 제어 비트에서 SYN 플래그가 1 일 때  무작위 채번 **( 초기 순서 번호 )**
    - **초기 순서 번호 + 송신한 바이트 수**가 순서 번호
    - **예시로 MSS 크기가 1000 바이트로 가정**
    
    | **전송할 파일의 크기 500,000 바이트** |
    | --- |
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f2636925-e81c-435b-900d-85ba6696597a/cc40c0a4-30fe-47ec-bcba-139be909de9b/image.png)
    

- **확인번호 응답 과정**
    - 순서 번호에 대한 응답 정보가 담겨져 있음
    - **수신자가 다음으로 받기를 기대하는 순서 번호를 전송**하며 일반적으로 ‘수신한 순서 번호 + 1’
    - 응답 시, 제어 비트에서 **ACK 플래그가 1**로 설정 후 응답
    - **TCP 연결에서 순서가 바뀐 세그먼트를 수신할 때 호스트는 어떤 행동을 하는가?**
        - 기본적으로 2가지 선택지가 존재
            1. 수신자가 순서가 바뀐 세그먼트를 즉시 버린다.
                - 수신자 설계를 단순화할 수 있다.
            2. 수신자는 바뀐 데이터를 보유하고, 빈 공간에 잃어버린 데이터를 채우기 위해 기다린다.
                - 네트워크 대역폭 관점에서는 효율적이며, 실제로 취하는 방법

---

### 📌 TCP 연결 수립과 종료

**❗연결 수립 : 쓰리 웨이 핸드셰이크**

**→ 세 개의 단계로 이루어진 TCP의 연결 수립 과정 ( HTTP 통신 전)**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f2636925-e81c-435b-900d-85ba6696597a/a975efbb-b635-4597-933a-40243cf47013/image.png)

| **송수신 방향** | **세그먼트** | **세그먼트에 포함된 주요 정보** | **비유** |
| --- | --- | --- | --- |
| 클라이언트 → 서버 | SYN 세그먼트 | 클라이언트의 초기 순서 번호
SYN | “연결 시작합니다” |
| 서버 → 클라이언트  | SYN+ACK 세그먼트 | 서버의 초기 순서 번호
클라이언트에 대한 응답 번호
SYN + ACK | “네, 확인했습니다. 연결 시작해요!” |
| 클라이언트 → 서버 | ACK 세그먼트 | 클라이언트에 다음 순서 번호
서버에 대한 응답 번호
ACK | “네, 확인했습니다” |
- **액티브 오픈**
    - 처음 연결을 시작하는 호스트의 연결 수립 과정
    - 서버 - 클라이언트 관계에서 클라이언트에 의해 수행
- **패시브 오픈**
    - 연결을 요청 받고나서 요청에 따라 수립해는 과정
    - 서버 - 클라이언트 관계에서 서버에 의해 수행

---

**❗연결 종료 : 포 웨이 핸드셰이크**

**→ 네 개의 단계로 이루어진 TCP의 연결 종료 과정 ( HTTP 통신 후)**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f2636925-e81c-435b-900d-85ba6696597a/ae28d5b6-0fe0-42d6-94e6-d27f2781e78e/image.png)

| **송수신 방향** | **세그먼트** | **세그먼트에 포함된 주요 정보** | **비유** |
| --- | --- | --- | --- |
| 클라이언트 → 서버 | FIN 세그먼트 | FIN | “연결 끊을게요” |
| 서버 → 클라이언트  | ACK 세그먼트 | 클라이언트에 대한 응답 번호
ACK | “네, 확인했습니다.” |
| 서버 → 클라이언트 | FIN 세그먼트 | FIN | “이제 연결 끊어요” |
| 클라이언트 → 서버 | ACK 세그먼트 | 서버가 전송한 세그먼트에 대한 확인 응답 번호
ACK | “네, 확인했습니다” |
- **FIN 패킷을 보낼 때는 순서번호가 없나?**
    - FIN 패킷을 보낼 때, **순서 번호(Sequence Number)**는 그동안 송신된 데이터의 마지막 바이트에 해당하는 번호가 포함됩니다.
    
    ### FIN 패킷에 포함되는 순서 번호:
    
    - FIN을 보낼 때 순서 번호는 **마지막으로 전송된 데이터 바이트의 순서 번호 + 1**로 설정됩니다. 이 때문에 FIN 패킷은 **1 바이트의 데이터**로 간주됩니다.
    - FIN 패킷이 전송되면, 수신 측은 FIN 플래그가 설정된 패킷을 받고 이에 대해 **ACK 응답**을 보내면서 해당 순서 번호를 확인하게 됩니다.
    
    즉, FIN 패킷도 일반적인 TCP 세그먼트처럼 순서 번호가 필요하며, 이 순서 번호는 연결 종료를 위한 필수적인 요소입니다. **TCP 연결 종료 과정**에서도 데이터의 순차적 전송 및 확인이 필요하므로 순서 번호는 항상 포함 됩니다.
    

- **액티브 클로즈**
    - 먼저 연결을 종료하는 호스트의 수행 과정
- **패시브 클로즈**
    - 연결 종료를 요청 받고나서 요청에 따라 수립해는 과정

---

### 📌 TCP 상태

- **TCP 상태란?**
    - 현재 어떤 통신 과정에 있는지 나타내는 정보
    - TCP는 상태를 유지하고 활용한다는 점에서 **스테이트풀(stateful) 프로토콜**이라 불림

**❗연결이 수립되지 않은 상태**

- **CLOSED**
    - 아무런 연결이 없는 상태
- **LISTEN**
    - 연결 대기 상태
    - 서버로서 동작하는 호스트는 LISTEN 상태를 유지
    - SYN 세그먼트를 기다리는 상태 **( 받을 시 쓰리 웨이 핸드셰이크 발생 )**

---

**❗연결 수립 상태**
- **SYN-SENT**
    - 액티브 오픈 호스트가 SYN 세그먼트를 보내고 SYN+ACK를 기다리는 상태
- **SYN-RECEIVED**
    - SYN+ACK를 보내고 그에 대한 ACK를 기다리는 상태
- **ESTABLISHED**
    - 연결이 확립 되어 있음을 나타내는 상태
---

**❗연결 종료 상태**

- **FIN-WAIT-1**
    - 일반적인 TCP 연결 종료 과정의 첫 단계
    - 연결 종료 요청을 보낸 액티브 클로즈 호스트가 가짐
- **CLOSE-WAIT**
    - 연결 종료 요청을 받고 ACK 세그먼트를 보낸 후 대기하는 상태
- **FIN-WAIT-2**
    - 상대 호스트의 FIN을 기다리는 상태
- **LAST-ACK**
    - CLOSE-WAIT에서 FIN 세그먼트를 전송한 뒤에 이에 대한 ACK 세그먼트를 기다리는 상태
- **TIME-WAIT**
    - 액티브 클로즈 호스트가 FIN을 수신한 뒤, ACK 세그먼트를 전송한 상태
    - **패시브 클로즈는 ACK를 수신한 뒤 바로 CLOSED가 되지만 액티브는 일정 시간 뒤에 CLOSED 로 전이 ( 패시브 클로즈 호스트이 ACK를 받을 때 까지 충분히 기다려 주는 것 )**

---

### 📌 UDP 데이터그램 구조

- **UDP는 스테이트리스(stateless) 프로토콜의 일종**
- **연결 수립 및 해제, 재전송, 혼잡제어, 흐름 제어를 수행하지 않음**
- **주로 실시간 스트리밍 서비스, 인터넷 전화, DNS에 쓰임 ( 실시간성에 쓰임 )**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f2636925-e81c-435b-900d-85ba6696597a/23bcacc3-588e-46ea-9cba-3db8d8273ba6/image.png)

- **송신지(출발지) 포트 , 수신지(목적지) 포트**
    - 송신지 또는 수신지의 애플리케이션을 식별하는 포트 번호

- **길이**
    - 헤더를 포함한 UDP 데이터그램의 바이트가 담겨 있음

- **체크섬**
    - 데이터그램 전송 과정에서 오류가 발생했는지 검사하기 위한 필드
    - 문제있다고 판단한 데이터그램은 폐기

### 📌 UDP 데이터그램 구조

## ⭐ 스터디 끝난 회고

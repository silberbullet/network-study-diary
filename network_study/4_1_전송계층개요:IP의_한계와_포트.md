# 4-1 전송 계층 개요: IP의 한계와 포트

스터디 일자 : 2024.9.23 (월) 20:00

[스터디 끝난 회고](#-스터디-끝난-회고)

## 📚 공부 정리

### 📌 신뢰할수 없는 통신과 비연결형 통신

**❗IP 단점**
 - 신뢰할수 없는(비신뢰성) 프로토콜
   - IP 프로토콜이 패킷이 수신지까지 제대로 전송되었다는 보장이 없는 특징 ( 손상되거나, 중복된 전송이 일어나도 재전송 X ) 
   - **최선형 전달**    
 - 비연결형 프로토콜
   - 송수신 호스트 간에 사전 연결 수립 작업을 거치지 않는 특징 ( 단순히 수신지를 향행 패킷을 전달 )
 - **IP를 통한 패킷의 전달은 신뢰성이 없는 통신이자 연결을 수립하는 과정이 없는 통신**

**❗IP가 단순히 수신의 목적만 가지고 있는 이유**

**성능** 
 - 모든 패킷이 전송이 잘 됐는지 일일 확인하고, 호스트 간에 연결을 수립하는 작업은 일반적으로 패킷의 **빠른** 송수신과는 배치되는 작업
 - 성능상 악영향으로 이어짐
 - 모든 서비스가 신뢰성 있는 전송이 필요하지는 않음 ( EX. 실시간 동영상 스트리밍 서비스 )

### 📌 IP의 한계를 보완하는 전송 계층

**❗연결형 통신 지원**
 - 전송 프로토콜 **TCP 지원**
   - 두 호스트가 정보를 주고받기 전에 가상의 회선을 설정하듯이 연결을 수립
   - 송수신하는 동안 연결 유지, 끝나면 연결 종료
    
**❗신뢰성 있는 통신 지원**
 - **TCP로 인한 신뢰성 있는 통신 지원**
   - 패킷이 수신지까지 올바른 순서대로의 전달을 보장하기 위해 재전송,오류제어, 흐름제어, 혼잡 제어를 제공

**❗가끔은 높은 성능의 통신 지원**
 - 전송 프로토콜 **UDP 지원**
   - 신뢰할 수 없는 통신, 비연결형 통신 지원하는 UDP는 **TCP 보다 더 빠른 전송이 가능함**
   
### 📌 응용 계층과의 연결다리, 포트

**❗포트의 정의**
 - 패킷은 수신지의 호스트의 주소까지 전달이 끝이 아닌, 호스트에서 실행되고 있는 **애플리케이션 프로세스**의 도달을 해야함__
   - 프로세스란 실행 중인 프로그램을 의미함 ( PID라는 번호로 식별 됨 )
 - 포트는 **특정 애플리케이션을 식별할 수 있는 정보**

**❗포트의 분류**
 - 포트는 기본적으로 16비트로 표현 가능 ( 65536 개의 포트를 이용할 수 있음 )
 - **잘 알려진 포트(시스템 포트)** ( 0~1023 )
    - 20,21 : FTP
    - 22 : SSH
    - 23 : TELNET
    - 53 : DNS__
    - 67,68 : DHCP
    - 80 : HTTP
    - 443 : HTTPS
 - **등록된 포트**
    - 1194 : OpenVpn
    - 1443 : Microsoft SQL DB
    - 3306 : MySql DB
    - 6379 : Redis
    - 8080 : HTTP 대체
 - **동적포트, 사설포트, 임시포트**
    - 49152 ~ 65535
    - **웹 브라우저 프로그램**이 동적 포트 내의 임의의 포트 번호가 자동 할당 

IP 주소와 포트 번호에 대한 정보가 함께 주어지면 **특정 호스트에서 실행 중인 특정 애플리케이션 프로세스**를 식별 할 수 있음

### 📌 포트 기반 NAT

**❗NAT 란**
 - IP 주소를 변환하는 기술
 - 주로 사설 IP를 공인 IP 주소를 변환하는데 이용

**❗NAT 변환 테이블**
 - 변환의 대상이 되는 IP 주소 쌍이 저장되어 있음
 - 옛날에는 사설 IP 하나당 공인 IP가 1:1 매핑이었으나 현재는 N : 1 형식으로 바뀜
   
**❗NAPT**
 - APT 라고 부르기도 함
 - 포트를 활용해 하나의 공인 IP 주소를 여러 사설 IP 주소가 공유할 수 있도록 하는 NAT 일종
 - 네트워크 외부에서 사용할 IP 주소가 같더라도 포트 번호가 다르면 네트워크 내부의 호스트를 특정 가능

#### NAPT NAT Table Example

| Private IP Address | Private Port | Public IP Address | Public Port | Protocol | Connection State |
|--------------------|--------------|-------------------|-------------|----------|------------------|
| 192.168.0.10       | 12345        | 203.0.113.5       | 56789       | TCP      | ESTABLISHED      |
| 192.168.0.11       | 23456        | 203.0.113.5       | 56790       | TCP      | ESTABLISHED      |
| 192.168.0.12       | 34567        | 203.0.113.5       | 56791       | TCP      | ESTABLISHED      |
| 192.168.0.10       | 45678        | 203.0.113.5       | 56792       | UDP      | ESTABLISHED      |
| 192.168.0.13       | 56789        | 203.0.113.5       | 56793       | TCP      | TIME_WAIT        |

### 📌 포트포워딩
- 네트워크 내 특정 호스트에 IP 주소와 포트 번호를 미리 할당하고, 해당 IP 주소:포트 번호로써 해당 호스트에게 패킷으로 전달하는 기능
- 네트워크 외부에서 네트워크 내부로 통신을 시작할 때, 네트워크 내부의 서버를 외부에서 접속할 수 있도록 접속 정보를 공개하기 위해 사용

### 📌 ICMP
- IP의 비연결형, 비신뢰성을 보안하기 위한 **네트워크 계층** 프로토콜
- IP 패킷의 전송 과정에 대한 피드백 메시지를 얻기 위해 사용하는 프로토콜
- 네트워크상의 간단한 문제 진단 및 테스트를 위해 사용

**❗ICMP 메시지 종류**

| 메시지 유형           | Type | Code | 설명                                                                                  |
|-----------------------|------|------|---------------------------------------------------------------------------------------|
| **Echo Reply**         | 0    | 0    | Echo Request에 대한 응답 메시지로, 네트워크 연결 상태를 확인할 때 사용됩니다.            |
| **Destination Unreachable** | 3    | 0    | 네트워크에 도달할 수 없음 (Network Unreachable).                                        |
|                       |      | 1    | 호스트에 도달할 수 없음 (Host Unreachable).                                            |
|                       |      | 2    | 프로토콜에 도달할 수 없음 (Protocol Unreachable).                                      |
|                       |      | 3    | 포트에 도달할 수 없음 (Port Unreachable).                                              |
|                       |      | 4    | 단편화 필요 (Fragmentation Needed and DF Set).                                          |
|                       |      | 5    | 소스 경로 실패 (Source Route Failed).                                                  |
| **Redirect**           | 5    | 0    | 네트워크 경로 변경 필요 (Redirect for Network).                                        |
|                       |      | 1    | 호스트 경로 변경 필요 (Redirect for Host).                                             |
| **Echo Request**       | 8    | 0    | 네트워크 연결 상태를 확인하기 위한 요청 메시지. 보통 `ping` 명령어에서 사용됩니다.       |
| **Time Exceeded**      | 11   | 0    | 패킷의 TTL(Time to Live)이 초과하여 더 이상 전달되지 않을 때 사용됩니다.                |
|                       |      | 1    | 재조립 시간 초과 (Fragment Reassembly Time Exceeded).                                  |
| **Parameter Problem**  | 12   | 0    | 잘못된 헤더 필드로 인해 패킷을 처리할 수 없을 때 전송됩니다.                           |

## ⭐ 스터디 끝난 회고


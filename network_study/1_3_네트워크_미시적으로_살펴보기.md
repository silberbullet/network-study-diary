# 1.3 네트워크 거시적으로 살펴보기

스터디 일자 : 2024.8.25 (일) 13:00

[스터디 끝난 회고](#-스터디-끝난-회고)

## 📚 공부 정리

#### 1. 프로토콜

프로토콜은 **노드 간에 정보를 올바르게 주고 받기 위해 합의된 규칙이나 방법**을 뜻한다.

A (한국어) ----> B (영어) 

위 처럼 정보를 전달하려고 할 때 B에서는 한국어를 이해할 수 없으니 정보 전달이 제대로 안될 것이다.

A (한국어) ----> B (한국어)

위 같은 경우는 둘 다 정보를 해석하는데 이해 할 수 있는 언어 환경을 가졌기 때문에 A는 B에게 정보를 정확히 전달 할 수 있다.

`패킷 교환` 방식도 마찬가지 이다. 패킷의 `헤더`, `페이로드`, `트레일러`를 다른 수신지의 정확히 전달하려면 송수신 사이에 패킷을 이해할 규칙이나 방법이 필요하다.

`프로토콜 종류`에는 **IP, ARP, HTTP, HTTPS, TCP, UDP 등**이 존재한다. 모든 프로토콜에는 저마다의 `목적`과 `특징`이 존재한다.
그렇기 때문에 특정 프로토콜로 주고받는 패킷의 부가 정보도 달라질 수 있다. 즉, **패킷의 헤더 내용이 달라질 수 있다는 의미이다.**

> 물론 헤더가 없는 프로토콜도 존재한다.
  
#### 2. 네트워크 참조 모델

![네트워크정보전달계층 drawio](https://github.com/user-attachments/assets/00596d5f-9018-45cc-b734-27f9dd9554df)

 네트워크가 정보를 주고받을 때는 정형화된 여러 단계가 존재한다. ( 택배와 똑같은 구조라고 생각하면 된다.)
 이 과정은 계층으로 표현할 수 있으며, 통신이 일어나는 각 가정을 계층으로 나눈 구조를 `네트워크 참조 모델`이라고 한다. 혹은 네트워크 계층으로 표현한다는 점에서 `네트워크 계층 모델`이라고 부르기도 한다.

 **통신과정을 계층으로 나눈 이유**

  1) 네트워크 구성과 설계가 용이
     - 계층 별로 수행해야 할 역할이 정해져 있기에 목적에 맞는 프로토콜과 네트워크 장비를 구성할 수 있음.
     -  하지만 모든 **모든 프로토콜이나 네트워크 장비가 참조 모델과 완벽하게 들어맞는 것은 아니고 어디까지나 가이드라인임**  
       
  2) 네트워크 문제 진단과 해결이 용이
     - 통신 과정에서 문제가 발생하면 추적하기 용이
     - 1계층 부터 순서대로 진단하면서 진단과 해결이 수월함 

 대표적인 네트워크 참조 모델 `OSI 모델`과 `TCP/IP` 모델이 존재

**OSI 모델**

  1) 물리 계층 
      - OSI 최하단 계층으로 1과 0으로 비트 신호를 주고 받는 계층 ( 근원적으로 통신이 이루어지는 계층 )

  2) 데이터 링크 계층
      - 네트워크 내 주변 장치 간의 정보를 올바르게 주고받기 위한 계층
      - 물리 계층을 통해 주고받은 정보에 오류 없는지 검증
      - MAC 주소라는 주소 체계를 통해 네트워크 내 송수신지를 특정함
      - **전송 과정에서 발생할 수 있는 충돌 문제를 해결하는 계층**

  3) 네트워크 계층
      - 메시지를 `다른 네트워크에 속한 수신지`까지 전달하는 계층
      - 인터넷을 가능하게 하는 계층
      - IP 주소라는 주소 체계를 통해 수신지 호스트와 네트워크를 식별하고 수신지에 도달하기 위한 **최적의 경로를 결정**

  4) 전송 계층
      - 패킷이 정상적으로 보내 졌는지 유실 등을 파악하는 계층
      - 패킷의 흐름 제어, 전송 오류를 점검하고 안정적인 전송이 이루어짐.
      - 포트 정보를 통해 실행중인 응용 프로그램을 식별함

  5) 세션 계층
      - 통신을 주고받는 호스트의 응용 프로그램 간 연결 상태를 `세션`이라고 통칭
      - 연결 상태를 생성하거나 유지하고, 종료 되었을 때 끊어주는 역할

  6) 표현 계층
      - 우리가 사용한 Java,C,js를 컴퓨터가 이해할 수 있는 코드로 변환하거나, 압축, 암호화 작업이 이루어지는 계층

  7) 응용 계층
       - 사용자가 이용하는 응용 프로그램과 맞닿아 있는 계층
       - 사용자가 이용할 응용 프로그램에 다양한 네트워크 서비스 제공

**TCP/IP 모델**
OSI에는 이론에 가까운 모델이라면 TCP/IP는 **구현에 중점을 둔 네트워크 참조 모델** 이다. 
`TCP/IP 4계층`, `인터넷 프로토콜 스위트`,`TCP/IP 프로토콜 스택`이라고도 불린다.

TCP와 IP는 오늘날 네트워크 구현의 핵심으로 간주됨. 

  1) 네트워크 액세스 계층
        - `링크 계층` 혹은 `네트워크 인터페이스 계층`이라고 불림
        - OSI의 데이터 링크 계층 역할을 수행하는 쪽에 가까움
  2) 인터넷 계층
        - OSI의 네트워크 계층과 유사함
  3) 전송 계층
        - OSI의 전송계층과 유사함
  4) 응용 계층
        - 세션 계층, 표현 계층, 응용 계층을 합친 것과 같음
 
#### 3. 캡슐화(역캡슐화)

패킷을 송신하는 과정에는 **캡슐화**가 일어나고 수신하는 과정에는 **역캡슐화**가 일어난다.

메시지 이동 경로는 다음과 같다.

  송신 : 가장 높은 계층 -> 가장 낮은 계층 </br>
  수신 : 가장 낮은 계층 -> 가장 높은 계층

**캡슐화**

상위 계층으로부터 내려받은 패킷을 페이로드로 삼아, **프로토콜에 걸맞는 헤더 혹은 트레일러를 덧붙인 후** 하위 계층으로 전달한다.

**역캡슐화**

하위 계층으로부터 올려받은 패킷에서 **캡슐화 과정에 덧붙였던 헤더나 트레일러를 각 계층에서 확인한 후 제거** 하여 상위 계층으로 보낸다.

> PDU 각 계층에서 송수신 되는 단위

응용, 표현, 세션 : 데이터 (data ) 
전송 : 세그먼트 ( TCP 프로토콜 ), 데이터그램 ( UDP 프로토콜 )
네트워크 계층 : 패킷
데이터 링크 계층 : 프레임
물리 계층 : 비트 

#### 4. 참조

❗ OSI 7계층, TCP/IP 4계층은 아무것도 아니고 단순한 **가이드 라인**에 불가하다.

현재도 새로운 프로토콜과 네트워크 장비는 만들어지고, 모든 프로토콜이 모델의 특정 계층에 완벽히 대응을 하는 것은 아니다.

특정 계층으로 분류하기 어렵겨나 **여러 계층을 포괄하는 프로토콜이나 네트워크 장비도 얼마든지 있다.**

**네트워크 참조 모델이나 특정 계층은 네트워크를 작동시키는 주체가 아니다.** 단순한 큰 그림이나 '모델'일 뿐이다. 

❗ 트래픽과 네트워크 성능 지표

`트래픽`이란 네트워크 내의 정보량을 의미한다. 통신 매체에 흐르는 정보의 수가 트래픽의의 양이다.

특정 노드에 트래픽이 몰린다는 것은 해당 노드가 특정 시간 동안 처리해야 할 정보가 많음을 의미한다. 이 경우 해당 노드에 **과부화**가 생길 수 있다. 네트워크의 성능은 어떻게 평가 할 수 있을까? `처리율`, `대역폭`, `패킷 손실`로 기준을 잡을 수 있다.

**처리율**은 단위 시간당 네트워크르 통해 실제로 전송되는 정보량을 의미한다. bps, Mbps, Gbps 단위로 표현되며, 때로는 초당 패킷 수로 표현하기 위해 pps로 표현 된다. 비교적 실시간성이 강조된 지표로, 특정 노드가 얼마만큼의 트래픽을 처리하는 중인지 판단하기 위해 사용되는 경우

**대역폭**은 신호 처리 영역에서의 정의와 네트워크 성능 측정 영역에서의 정의가 다소 다르다. **단위 시간 동안 통신 매체를 통해 송수신할 수 있는 최대 정보량**을 의미한다. 높은 대역폭을 가지고 있다는 것은 많은 정보를 송수신할 능력이 있다는 것이다.

**패킷 손실**은 말 그대로 송수신되는 패킷이 손실된 상황을 의미한다. 높은 트래픽으로 인해 노드가 순간적으로 처리해야 할 패킷이 너무 많아지거나 네트워크상에 예기치 못한 장애가 발생하면 패킷 손실이 발생할 수 있다. 

CMD 창에 ping <수신지 주소> 형식으로 패킷 손실 파악이 가능하다.

## ⭐ 스터디 끝난 회고

#### 패킷의 트레일러는 어떻게 활용이 되고 있을까?

1. FCS 
- 데이터 링크 계층에서 확인하는오류 검출 매커니즘
- 송신 : 헤더 + 페이로드 값을 알고리즘 (CRC)를 통해 고유한 FCS 값을 트레일러에 붙임
- 수신 : FCS 값을 CRC 알고리즘으로 역복호화 하여 헤더랑 페이로드가 변조 혹은 손상 됐는지 확인

 ❗JWT의 시그니처와 비슷함
   - 시그니쳐 : 헤더랑 페이로드 암호화 한 후 알고리즘을 또 암호화함
   - 
#### 대규모 트래픽을 경험 혹은 학습

대규모 트래픽을 흉내내는 방법에는 다음 같은 도구로 임의 부하를 낼 수 있다.

1. **AB (Apache Benchmark)**
    - 주요 기능: 간단한 웹 서버 성능 테스트 도구, 특정 URL에 다수의 요청을 보내 서버의 응답 성능을 평가.
    - 모니터링: 실시간 모니터링 기능 없음. 외부 도구를 사용하여 서버 모니터링 필요.

2. **JMeter**
     - 주요 기능: 다양한 프로토콜 지원, 복잡한 테스트 시나리오 작성 가능, 웹 애플리케이션 성능 테스트에 적합.
     - 모니터링: 실시간 모니터링 가능(그래프, 표 등), 외부 모니터링 도구와 연동 가능.

3. **nGrinder**
     - 주요 기능: 대규모 분산 성능 테스트 지원, Jython 기반 사용자 정의 테스트 작성 가능, 웹 인터페이스 제공.
     - 모니터링: 강력한 실시간 모니터링 기능 제공(대시보드), 외부 시스템 모니터링 도구와 연동 가능.

그걸 모니터링에 쉽게 시각화 해주는 것은 

1. **Prometheus (프로메테우스)**
     - 역할 : 모니터링 및 알림 시스템으로, 애플리케이션, 서버, 컨테이너 등의 성능 데이터를 수집하고, 이를 시계열 데이터로 저장.
     - 특징
          - 시계열 데이터 저장: 메트릭(metric) 데이터를 시계열 형식으로 저장하여, 시간에 따른 변화를 추적.
          - Pull 모델: 각 대상 시스템으로부터 직접 데이터를 가져오는 방식으로 작동.
          - 알림 기능: 특정 조건에 맞는 경고(Alert)를 설정하고, 조건이 충족되면 알림을 발송.

2. **Grafana (그라파나)**
      - 역할: 데이터 시각화 도구로, Prometheus를 비롯한 다양한 데이터 소스의 데이터를 대시보드 형태로 시각화.
      - 특징
          - 대시보드 생성: 다양한 형태의 차트와 그래프로 데이터를 시각화할 수 있으며, 사용자 정의 대시보드를 쉽게 만들 수 있음.
          - 다양한 데이터 소스 지원: Prometheus 외에도 InfluxDB, Elasticsearch 등 다양한 데이터 소스와 연동 가능.
          - 실시간 모니터링: 실시간으로 데이터를 시각화하여, 시스템 상태를 한눈에 파악할 수 있음.

3. **Elasticsearch (엘라스틱 서치)**
      - 역할: 분산 검색 및 분석 엔진으로, 대규모 로그 데이터나 텍스트 데이터를 저장하고, 이를 빠르게 검색하고 분석할 수 있음.
      - 특징
          - 로그 관리: 대량의 로그 데이터를 효율적으로 저장하고, 필요할 때 빠르게 검색할 수 있음.
          - 분석 기능: 로그 데이터를 분석하여 패턴을 발견하거나, 특정 이벤트를 추적할 수 있음.
          - Kibana 연동: Kibana와 연동하여 Elasticsearch의 데이터를 시각화하고 대시보드를 구성할 수 있음.
       

이후 우리가 취해야 하는 상황은 병목 현상이 발견한 지점이 생긴다면 **SQL 튜닝 및 DB 설정을 바꾼다던지, 메모리를 사용해 캐시 전략을 한다던지, 서버를 스케일 업 혹은 스케일 아웃** 하는 방법이 있다.
